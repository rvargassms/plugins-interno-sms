tinymce.PluginManager.add('tab', function(editor, url) {
	  //DEFINICION DE MAQUETAS
	  var maqueta_content = " "
	  var maquetas = [
          	{id:"R_BsAs", 	title:"Regi&oacute;n Buenos Aires", content:"", tabs:[
	          	     {title:"Bah&iacute;a Blanca", 	 		content: maqueta_content, tabs:[] },
	          	     {title:"Chivilcoy", 	 				content: maqueta_content, tabs:[] },
	          	     {title:"Jun&iacute;n", 	 			content: maqueta_content, tabs:[] },
	          	     {title:"La Plata", 	 				content: maqueta_content, tabs:[] },
	          	     {title:"Mar del Plata", 				content: maqueta_content, tabs:[] },
	          	     {title:"Buenos Aires Centro", 	 		content: maqueta_content, tabs:[] },
	          	     {title:"Trenque Lauquen", 				content: maqueta_content, tabs:[] },
	          	     {title:"Lobos", 						content: maqueta_content, tabs:[] },
	          	     {title:"Pergamino", 					content: maqueta_content, tabs:[] }
          	]},
          	{id:"R_Cord", 	title:"Regi&oacute;n C&oacute;rdoba", 	content:"", tabs:[
	  	             {title:"C&oacute;rdoba Centro", 	 	content: maqueta_content, tabs:[] },
	  	             {title:"R&iacute;o Cuarto", 	 		content: maqueta_content, tabs:[] },
	  	             {title:"Villa Mar&iacute;a", 	 		content: maqueta_content, tabs:[] }
  	        ] },
          	{id:"R_Cuyo",	title:"Regi&oacute;n Cuyo", 	content:"", tabs:[
	          	     {title:"Mendoza", 	 					content: maqueta_content, tabs:[] },
	  	             {title:"San Luis", 	 				content: maqueta_content, tabs:[] },
	  	             {title:"San Juan", 	 				content: maqueta_content, tabs:[] }
          	] },
          	{id:"R_Metro", 	title:"Regi&oacute;n Metropolitana",content:"", tabs:[
					{title:"Regi&oacute;n Metropolitana", 	content: maqueta_content, tabs:[] }
             ] },
          	{id:"R_NEA", 	title:"Regi&oacute;n NEA", 		content:"", tabs:[
		      	     {title:"Chaco", 	 					content: maqueta_content, tabs:[] },
		             {title:"Corrientes", 	 				content: maqueta_content, tabs:[] },
		             {title:"Del Paran&aacute;", 	 		content: maqueta_content, tabs:[] },
		             {title:"Formosa", 	 					content: maqueta_content, tabs:[] },
		             {title:"Misiones", 	 				content: maqueta_content, tabs:[] },
		             {title:"R&iacute;o Uruguay", 	 		content: maqueta_content, tabs:[] },
		             {title:"Rosario", 	 					content: maqueta_content, tabs:[] },
		             {title:"Santa F&eacute;", 	 			content: maqueta_content, tabs:[] }
	      	] },
          	{id:"R_NOA", 	title:"Regi&oacute;n NOA", 		content:"", tabs:[
				     {title:"Catamarca", 	 				content: maqueta_content, tabs:[] },
				     {title:"Jujuy", 	 					content: maqueta_content, tabs:[] },
				     {title:"La Rioja", 	 				content: maqueta_content, tabs:[] },
				     {title:"Salta", 	 					content: maqueta_content, tabs:[] },
				     {title:"Santiago del Estero",			content: maqueta_content, tabs:[] },
				     {title:"Tucum&aacute;n", 	 			content: maqueta_content, tabs:[] },
			] },
          	{id:"R_SUR", 	title:"Regi&oacute;n Sur", 		content:"", tabs:[
	          	     {title:"Bariloche", 	 				content: maqueta_content, tabs:[] },
	  	             {title:"Comodoro Rivadavia", 			content: maqueta_content, tabs:[] },
	  	             {title:"La Pampa", 	 				content: maqueta_content, tabs:[] },
	  	             {title:"Norpatag&oacute;nica", 	 	content: maqueta_content, tabs:[] },
	  	             {title:"Santa Cruz", 	 				content: maqueta_content, tabs:[] },
	  	             {title:"Trelew", 	 					content: maqueta_content, tabs:[] },
	  	             {title:"Tierra del Fuego", 			content: maqueta_content, tabs:[] },
          	] },
          ]; 
	          

	function generateTemplate(title,content){
		return content;
		/*return "<table class='panel maqueta '> " +
					"<tr><th class='panel-heading panel-heading-maqueta panel-title '>" +
							"<div class='mceNonEditable'> Maqueta: "+title+" " +
							"<span class='pull-right mceNonEditable'><span class='glyphicon glyphicon-remove delete-panel' aria-hidden='true' ></span></span>" +
							"</div>" +
					"</th></tr>" + 
					"<tr><td class='panel-body mceEditable' ><p>"+content+" </p></td></tr>"+
				"</table>"*/
	}

	function generateTab(title,content){
		return "<table class='panel panel-success tab'>" +
						"<tr><td class='panel-heading panel-heading-success panel-title tab-title'> " +
						"<span>"+title+"</span>" +
						"<span class='pull-right mceNonEditable'><span class='glyphicon glyphicon-remove delete-panel' aria-hidden='true' ></span></span>"+
					"</td></tr>" + 
					"<tr><td class='panel-body tab-body' ><p>"+content+"</p></td></tr>"+
				"</table>";
	}
    
	editor.addMenuItem('tab', {
        text: 'Solapa',
        context: 'tools',
        onclick: function() {
            editor.insertContent(generateTab("T&iacute;tulo de la solapa","Contenido"));
        }
    });
	editor.addButton('tab', {
	   title : 'Insertar Solapa',
	   text: 'Tab',
       onclick : function() {
           editor.insertContent(generateTab("T&iacute;tulo de la solapa","Contenido"));
       }
   });
    
    
	
	///GENERACION DINAMICA DE MAQUETAS ///  
	var menuMaquetas = [];
    function generateContentFor(item){
    	//Genera el contenido y tabs si existen
		var content =  item["content"];
    	for(var i = 0; i < item["tabs"].length; i++){
    		var tab = item["tabs"][i];
    		//Por cada tab definida: Generar su contenido y crear tab.
    		var contentTab = generateContentFor(tab);
    		content+= generateTab(tab["title"],contentTab);
    	}
    	return content;
	}
    for(var i = 0; i < maquetas.length; i++){
    	var maqueta = maquetas[i];
    	var HTMLContent = generateContentFor(maqueta);
    	HTMLContent = generateTemplate(maqueta["title"],HTMLContent);
    	menuMaquetas.push({text: tinymce.html.Entities.decode(maqueta["title"]), classes:"maqueta-"+maqueta["id"]});
    	jQuery("body").on("click",".mce-maqueta-"+maqueta["id"],{html:HTMLContent},function(event){
    		editor.insertContent(event.data.html);
    	});
    }
    ///FIN GENERACION DINAMICA DE MAQUETAS ///  
	
	editor.addButton('maquetas', {
        type: 'menubutton',
        text: 'Maquetas',
        icon: false,
        menu: menuMaquetas
    });

});


